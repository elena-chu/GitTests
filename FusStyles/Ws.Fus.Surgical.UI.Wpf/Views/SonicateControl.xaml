<UserControl
  x:Class="Ws.Fus.Surgical.UI.Wpf.SonicateControl"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:extension="http://schemas.insightec.com/wpf/"
  xmlns:local="clr-namespace:Ws.Fus.Surgical.UI.Wpf"
  xmlns:sys="clr-namespace:System;assembly=mscorlib"
  mc:Ignorable="d"
  x:Name="_thisSonicateControl">
  
  <UserControl.Resources>
    <Duration x:Key="LDuration.Swell">0:0:1</Duration>
    
    <sys:TimeSpan x:Key="LTimeSpan.Swell.0">0:0:0</sys:TimeSpan>
    <sys:TimeSpan x:Key="LTimeSpan.Swell.1">0:0:1</sys:TimeSpan>
    <sys:TimeSpan x:Key="LTimeSpan.Swell.2">0:0:2</sys:TimeSpan>
    
    <sys:Double x:Key="LDouble.Width.OuterBoundary">588</sys:Double>
    <sys:Double x:Key="LDouble.Width.Cooling">374</sys:Double>
    <sys:Double x:Key="LDouble.Width.Back">400</sys:Double>
    <sys:Double x:Key="LDouble.Width.TrioCanvas">460</sys:Double>

    <Geometry x:Key="LGeometry.Halo">m 435.72756,161.8794 c -7.83281,-3.08305 -14.38371,1.7696 -10.96385,10.37201 21.09929,2.9554 106.93075,59.0056 121.22066,144.15807 C 534.36725,213.72777 457.10294,171.96934 435.72756,161.8794 Z m -186.31813,11.32159 c -45.08014,22.07763 -76.88038,58.50177 -97.96558,118.38855 0.9652,4.3434 8.36425,12.50599 13.62539,3.84521 13.63175,-61.827 48.68623,-94.71271 84.34019,-122.23376 z</Geometry>

    <Color x:Key="LColor.Highlight">#FF00E0FF</Color>
    <Color x:Key="LColor.Highlight.Transparent">#0000E0FF</Color>
    
    <RadialGradientBrush x:Key="LRadialGradientBrush.Highlight" Center="0.5,0.5" RadiusX="1" RadiusY="0.75">
      <RadialGradientBrush.GradientStops>
        <GradientStopCollection>
          <GradientStop Color="{StaticResource LColor.Highlight}"/>
          <GradientStop Color="{StaticResource LColor.Highlight.Transparent}" Offset="0.47"/>
        </GradientStopCollection>
      </RadialGradientBrush.GradientStops>
      <RadialGradientBrush.RelativeTransform>
        <TranslateTransform Y="-0.1"/>
      </RadialGradientBrush.RelativeTransform>
    </RadialGradientBrush>

    <!--LA: need to compute gradient stop for cooling progress-->
    <LinearGradientBrush x:Key="LLinearGradientBrush.Arc.Cooling" StartPoint="0,0" EndPoint="0,1">
      <LinearGradientBrush.GradientStops>
        <GradientStopCollection>
          <GradientStop Color="{StaticResource LColor.Highlight}" Offset="0"/>
          <GradientStop Color="{StaticResource LColor.Highlight.Transparent}" Offset="0.5"/>
        </GradientStopCollection>
      </LinearGradientBrush.GradientStops>
    </LinearGradientBrush>

    <LinearGradientBrush x:Key="LLinearGradientBrush.Arc.Long" StartPoint="0,0" EndPoint="0,1">
      <LinearGradientBrush.GradientStops>
        <GradientStopCollection>
          <GradientStop Color="{StaticResource LColor.Highlight}" Offset="0"/>
          <GradientStop Color="{StaticResource LColor.Highlight.Transparent}" Offset="0.4"/>
        </GradientStopCollection>
      </LinearGradientBrush.GradientStops>
    </LinearGradientBrush>

    <!--<LinearGradientBrush x:Key="LLinearGradientBrush.Arc.Medium" StartPoint="0,0" EndPoint="0,1">
      <LinearGradientBrush.GradientStops>
        <GradientStopCollection>
          <GradientStop Color="{StaticResource LColor.Highlight}" Offset="0"/>
          <GradientStop Color="{StaticResource LColor.Highlight.Transparent}" Offset="0.45"/>
        </GradientStopCollection>
      </LinearGradientBrush.GradientStops>
    </LinearGradientBrush>-->

    <LinearGradientBrush x:Key="LLinearGradientBrush.Arc.Short" StartPoint="0,0" EndPoint="0,1">
      <LinearGradientBrush.GradientStops>
        <GradientStopCollection>
          <GradientStop Color="{StaticResource LColor.Highlight}" Offset="0"/>
          <GradientStop Color="{StaticResource LColor.Highlight.Transparent}" Offset="0.05"/>
        </GradientStopCollection>
      </LinearGradientBrush.GradientStops>
    </LinearGradientBrush>

    <Style x:Key="LStyle.Ellipse" TargetType="{x:Type Ellipse}">
      <Setter Property="Height" Value="{Binding ActualWidth, RelativeSource={RelativeSource Self}}"/>
      <Setter Property="HorizontalAlignment" Value="Center"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
    </Style>

    <Style x:Key="LStyle.Ellipse.Back" TargetType="{x:Type Ellipse}" BasedOn="{StaticResource LStyle.Ellipse}">
      <Setter Property="Width" Value="{StaticResource LDouble.Width.Back}"/>
      <Setter Property="Fill" Value="{StaticResource XBrush.Application.Active}"/>
      <Setter Property="Opacity" Value="0.1"/>
      <Style.Triggers>
        <DataTrigger Binding="{Binding SonicateState, ElementName=_thisSonicateControl}" Value="SonicateReady">
          <DataTrigger.EnterActions>
            <BeginStoryboard>
              <Storyboard>
                <DoubleAnimation Storyboard.TargetProperty="Width" To="486" BeginTime="{StaticResource LTimeSpan.Swell.0}" Duration="{StaticResource LDuration.Swell}"/>
              </Storyboard>
            </BeginStoryboard>
          </DataTrigger.EnterActions>
        </DataTrigger>
      </Style.Triggers>
    </Style>

    <Style x:Key="LStyle.Ellipse.Highlight" TargetType="{x:Type Ellipse}" BasedOn="{StaticResource LStyle.Ellipse}">
      <Setter Property="Fill" Value="{StaticResource LRadialGradientBrush.Highlight}"/>
      <Setter Property="Opacity" Value="0.9"/>
    </Style>

    <Style x:Key="LStyle.Ellipse.Dotted" TargetType="{x:Type Ellipse}" BasedOn="{StaticResource LStyle.Ellipse}">
      <Setter Property="Width" Value="{StaticResource LDouble.Width.Cooling}"/>
      <Setter Property="Stroke" Value="{StaticResource XBrush.Application.Active}"/>
      <Setter Property="StrokeThickness" Value="2"/>
      <Setter Property="StrokeDashArray" Value="1,5"/>
      <Style.Triggers>
        <DataTrigger Binding="{Binding SonicateState, ElementName=_thisSonicateControl}" Value="SonicateReady">
          <DataTrigger.EnterActions>
            <BeginStoryboard>
              <Storyboard>
                <DoubleAnimation Storyboard.TargetProperty="Width" To="560" BeginTime="{StaticResource LTimeSpan.Swell.0}" Duration="{StaticResource LDuration.Swell}"/>
                <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0.1" BeginTime="{StaticResource LTimeSpan.Swell.0}" Duration="{StaticResource LDuration.Swell}"/>
                <DoubleAnimation Storyboard.TargetProperty="StrokeDashOffset" BeginTime="{StaticResource LTimeSpan.Swell.0}" To="20" Duration="{StaticResource LDuration.Swell}"/>
              </Storyboard>
            </BeginStoryboard>
          </DataTrigger.EnterActions>
        </DataTrigger>
      </Style.Triggers>
    </Style>

    <Style x:Key="LStyle.Ellipse.Dashed" TargetType="{x:Type Ellipse}" BasedOn="{StaticResource LStyle.Ellipse}">
      <Setter Property="Width" Value="{StaticResource LDouble.Width.TrioCanvas}"/>
      <Setter Property="Stroke" Value="{StaticResource XBrush.Application.Active}"/>
      <Setter Property="StrokeThickness" Value="2"/>
      <Setter Property="StrokeDashArray" Value="2,3"/>
      <Style.Triggers>
        <DataTrigger Binding="{Binding SonicateState, ElementName=_thisSonicateControl}" Value="SonicateReady">
          <DataTrigger.EnterActions>
            <BeginStoryboard>
              <Storyboard>
                <DoubleAnimation Storyboard.TargetProperty="Width" To="{StaticResource LDouble.Width.OuterBoundary}" BeginTime="{StaticResource LTimeSpan.Swell.0}" Duration="{StaticResource LDuration.Swell}"/>
                <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0.1" BeginTime="{StaticResource LTimeSpan.Swell.0}" Duration="{StaticResource LDuration.Swell}"/>
                <DoubleAnimation Storyboard.TargetProperty="StrokeDashOffset" BeginTime="{StaticResource LTimeSpan.Swell.0}" To="20" Duration="{StaticResource LDuration.Swell}"/>
              </Storyboard>
            </BeginStoryboard>
          </DataTrigger.EnterActions>
        </DataTrigger>
      </Style.Triggers>
    </Style>

    <Style x:Key="LStyle.Ellipse.CoolingArc" TargetType="{x:Type Ellipse}" BasedOn="{StaticResource LStyle.Ellipse}">
      <Setter Property="Width" Value="{StaticResource LDouble.Width.Cooling}"/>
      <Setter Property="Stroke" Value="{StaticResource LLinearGradientBrush.Arc.Cooling}"/>
      <Setter Property="StrokeThickness" Value="3"/>
      <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
    </Style>

    <Style x:Key="LStyle.Ellipse.LongArc" TargetType="{x:Type Ellipse}" BasedOn="{StaticResource LStyle.Ellipse}">
      <Setter Property="Width" Value="477"/>
      <Setter Property="Stroke" Value="{StaticResource LLinearGradientBrush.Arc.Long}"/>
      <Setter Property="StrokeThickness" Value="5"/>
      <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
      <Style.Triggers>
        <DataTrigger Binding="{Binding SonicateState, ElementName=_thisSonicateControl}" Value="SonicateReady">
          <DataTrigger.EnterActions>
            <BeginStoryboard>
              <Storyboard>
                <DoubleAnimation Storyboard.TargetProperty="Width" To="530" BeginTime="{StaticResource LTimeSpan.Swell.0}" Duration="{StaticResource LDuration.Swell}"/>
                <DoubleAnimation Storyboard.TargetProperty="StrokeThickness" To="3" BeginTime="{StaticResource LTimeSpan.Swell.0}" Duration="{StaticResource LDuration.Swell}"/>
                <DoubleAnimation Storyboard.TargetProperty="(Ellipse.RenderTransform).(RotateTransform.Angle)" To="-115" BeginTime="{StaticResource LTimeSpan.Swell.1}" Duration="{StaticResource LDuration.Swell}"/>
                <DoubleAnimation Storyboard.TargetProperty="Stroke.GradientStops[1].Offset" To="0.45" BeginTime="{StaticResource LTimeSpan.Swell.1}" Duration="{StaticResource LDuration.Swell}"/>
              </Storyboard>
            </BeginStoryboard>
          </DataTrigger.EnterActions>
        </DataTrigger>
      </Style.Triggers>
    </Style>

    <!--<Style x:Key="LStyle.Ellipse.MediumArc" TargetType="{x:Type Ellipse}" BasedOn="{StaticResource LStyle.Ellipse}">
      <Setter Property="Width" Value="414"/>
      <Setter Property="Stroke" Value="{StaticResource LLinearGradientBrush.Arc.Medium}"/>
      <Setter Property="StrokeThickness" Value="4"/>
      <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
    </Style>-->

    <Style x:Key="LStyle.Ellipse.ShortArc" TargetType="{x:Type Ellipse}" BasedOn="{StaticResource LStyle.Ellipse}">
      <Setter Property="Width" Value="410"/>
      <Setter Property="Stroke" Value="{StaticResource LLinearGradientBrush.Arc.Short}"/>
      <Setter Property="StrokeThickness" Value="5"/>
      <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
      <Style.Triggers>
        <DataTrigger Binding="{Binding SonicateState, ElementName=_thisSonicateControl}" Value="SonicateReady">
          <DataTrigger.EnterActions>
            <BeginStoryboard>
              <Storyboard>
                <DoubleAnimation Storyboard.TargetProperty="Width" To="500" BeginTime="{StaticResource LTimeSpan.Swell.0}" Duration="{StaticResource LDuration.Swell}"/>
                <DoubleAnimation Storyboard.TargetProperty="StrokeThickness" To="3" BeginTime="{StaticResource LTimeSpan.Swell.0}" Duration="{StaticResource LDuration.Swell}"/>
                <DoubleAnimation Storyboard.TargetProperty="(Ellipse.RenderTransform).(RotateTransform.Angle)" To="40" BeginTime="{StaticResource LTimeSpan.Swell.1}" Duration="{StaticResource LDuration.Swell}"/>
                <DoubleAnimation Storyboard.TargetProperty="Stroke.GradientStops[1].Offset" To="0.15" BeginTime="{StaticResource LTimeSpan.Swell.1}" Duration="{StaticResource LDuration.Swell}"/>
              </Storyboard>
            </BeginStoryboard>
          </DataTrigger.EnterActions>
        </DataTrigger>
      </Style.Triggers>
    </Style>

    <Style x:Key="LStyle.Path.Halo" TargetType="{x:Type Path}">
      <Setter Property="Fill" Value="{StaticResource XBrush.Application.Active}"/>
      <Setter Property="Opacity" Value="0.4"/>
      <Setter Property="Stretch" Value="Uniform"/>
      <Setter Property="Data" Value="{StaticResource LGeometry.Halo}"/>
      <Setter Property="VerticalAlignment" Value="Top"/>
      <Setter Property="Effect">
        <Setter.Value>
          <BlurEffect Radius="18" KernelType="Gaussian"/>
        </Setter.Value>
      </Setter>
    </Style>

    <Grid x:Key="LGrid.TrioMask" Width="{StaticResource LDouble.Width.OuterBoundary}" Height="{StaticResource LDouble.Width.OuterBoundary}">
      <Ellipse
          Width="{StaticResource LDouble.Width.TrioCanvas}"
          Height="{StaticResource LDouble.Width.TrioCanvas}"
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Fill="Black"/>
    </Grid>

    <Storyboard x:Key="LStoryboard.TrioStart">
      <!--<ThicknessAnimation Storyboard.TargetProperty="Margin" To="160,"-->
      <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0.6" BeginTime="{StaticResource LTimeSpan.Swell.1}" Duration="{StaticResource LDuration.Swell}"/>
      <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0.8" BeginTime="{StaticResource LTimeSpan.Swell.2}" Duration="{StaticResource LDuration.Swell}"/>
    </Storyboard>

    <Style x:Key="LStyle.Ellipse.Trio" TargetType="{x:Type Ellipse}">
      <Setter Property="HorizontalAlignment" Value="Left"/>
      <Setter Property="VerticalAlignment" Value="Top"/>
      <Setter Property="Opacity" Value="0"/>
      <Style.Triggers>
        <DataTrigger Binding="{Binding SonicateState, ElementName=_thisSonicateControl}" Value="SonicateReady">
          <DataTrigger.EnterActions>
            <BeginStoryboard Storyboard="{StaticResource LStoryboard.TrioStart}"/>
          </DataTrigger.EnterActions>
        </DataTrigger>
      </Style.Triggers>
    </Style>
    
    <Grid
      x:Key="LGrid.Trio"
      Background="{StaticResource XBrush.AlmostTransparent}"
      Width="{StaticResource LDouble.Width.OuterBoundary}"
      Height="{StaticResource LDouble.Width.OuterBoundary}"
      HorizontalAlignment="Center"
      VerticalAlignment="Center">
      <Grid.OpacityMask>
        <VisualBrush Stretch="None" Visual="{StaticResource LGrid.TrioMask}"/>
      </Grid.OpacityMask>
      <Grid.Effect>
        <BlurEffect Radius="10"/>
      </Grid.Effect>
      <Ellipse Margin="55,0,0,0" Width="240" Height="200" Style="{StaticResource LStyle.Ellipse.Trio}">
        <Ellipse.Fill>
          <RadialGradientBrush Center="0.5,0.5" RadiusX="1" RadiusY="1">
            <RadialGradientBrush.GradientStops>
              <GradientStopCollection>
                <GradientStop Color="{StaticResource XColor.Application.Active}" Offset="0"/>
                <GradientStop Color="{StaticResource XColor.Application.Active.Transparent}" Offset="0.7"/>
              </GradientStopCollection>
            </RadialGradientBrush.GradientStops>
            <RadialGradientBrush.RelativeTransform>
              <TranslateTransform X="0.2" Y="-0.3"/>
            </RadialGradientBrush.RelativeTransform>
          </RadialGradientBrush>
        </Ellipse.Fill>
      </Ellipse>
      <Ellipse
        Margin="160,58,0,0"
        Width="384"
        Height="{Binding ActualWidth, RelativeSource={RelativeSource Self}}"
        Style="{StaticResource LStyle.Ellipse.Trio}">
        <Ellipse.Fill>
          <RadialGradientBrush Center="0.5,0.5" RadiusX="1" RadiusY="1">
            <RadialGradientBrush.GradientStops>
              <GradientStopCollection>
                <GradientStop Color="{StaticResource XColor.Application.Active}" Offset="0"/>
                <GradientStop Color="{StaticResource XColor.Application.Active.Transparent}" Offset="0.5"/>
              </GradientStopCollection>
            </RadialGradientBrush.GradientStops>
            <RadialGradientBrush.RelativeTransform>
              <TranslateTransform X="0.1" Y="-0.4"/>
            </RadialGradientBrush.RelativeTransform>
          </RadialGradientBrush>
        </Ellipse.Fill>
      </Ellipse>
      <Path
        Margin="270,64,0,0"
        VerticalAlignment="Top"
        HorizontalAlignment="Left"
        Width="240"
        Stretch="Uniform"
        Opacity="0"
        Data="M 90.026782,65.63255 C 112.62696,59.674449 131.59513,49.816534 141.76328,35.4529 c 16.2701,-22.983302 28.7426,-47.42515 63.2336,-28.7425095 34.491,18.6826295 37.3652,83.3532895 8.6227,112.0958095 -28.7425,28.74251 -80.4791,76.16767 -133.652698,74.73053 -49.1393,-1.3281 -93.4132,-31.61676 -76.1677007,-67.5449 C 22.784682,86.43877 52.946377,75.408081 90.026782,65.63255 Z">
        <Path.Fill>
          <RadialGradientBrush Center="0.5,0.5" RadiusX="1.5" RadiusY="1">
            <RadialGradientBrush.GradientStops>
              <GradientStopCollection>
                <GradientStop Color="{StaticResource XColor.Application.Active}" Offset="0"/>
                <GradientStop Color="{StaticResource XColor.Application.Active.Transparent}" Offset="0.3"/>
              </GradientStopCollection>
            </RadialGradientBrush.GradientStops>
            <RadialGradientBrush.RelativeTransform>
              <TransformGroup>
                <TranslateTransform X="-0.35" Y="0.2"/>
                <RotateTransform Angle="-37"/>
              </TransformGroup>
            </RadialGradientBrush.RelativeTransform>
          </RadialGradientBrush>
        </Path.Fill>
        <Path.Style>
          <Style TargetType="{x:Type Path}">
            <Style.Triggers>
              <DataTrigger Binding="{Binding SonicateState, ElementName=_thisSonicateControl}" Value="SonicateReady">
                <DataTrigger.EnterActions>
                  <BeginStoryboard Storyboard="{StaticResource LStoryboard.TrioStart}"/>
                </DataTrigger.EnterActions>
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </Path.Style>
      </Path>
    </Grid>

  </UserControl.Resources>

  <Viewbox Stretch="Uniform">
    <Grid Width="{StaticResource LDouble.Width.OuterBoundary}" Height="{StaticResource LDouble.Width.OuterBoundary}">

      <Ellipse x:Name="BackgroundEllipse" Style="{StaticResource LStyle.Ellipse.Back}"/>
      <Ellipse Width="{Binding ActualWidth, ElementName=BackgroundEllipse}" Style="{StaticResource LStyle.Ellipse.Highlight}"/>

      <ContentControl Content="{StaticResource LGrid.Trio}"/>

      <Border
        Width="{Binding ActualWidth, ElementName=BackgroundEllipse, Converter={extension:ScalarConverter}, ConverterParameter=0.9}"
        Height="{Binding ActualWidth, RelativeSource={RelativeSource Self}}"
        HorizontalAlignment="Center"
        VerticalAlignment="Center">
        <Path Style="{StaticResource LStyle.Path.Halo}"/>
      </Border>
      <Ellipse Style="{StaticResource LStyle.Ellipse.Dashed}"/>
      <Ellipse Style="{StaticResource LStyle.Ellipse.Dotted}"/>
      <Ellipse Style="{StaticResource LStyle.Ellipse.CoolingArc}">
        <Ellipse.RenderTransform>
          <RotateTransform/>
        </Ellipse.RenderTransform>
      </Ellipse>
      <Ellipse Style="{StaticResource LStyle.Ellipse.LongArc}">
        <Ellipse.RenderTransform>
          <RotateTransform Angle="-105"/>
        </Ellipse.RenderTransform>
      </Ellipse>
      <!--Not sure need this:-->
      <!--<Ellipse Style="{StaticResource LStyle.Ellipse.MediumArc}">
        <Ellipse.RenderTransform>
          <RotateTransform/>
        </Ellipse.RenderTransform>
      </Ellipse>-->
      <Ellipse Style="{StaticResource LStyle.Ellipse.ShortArc}">
        <Ellipse.RenderTransform>
          <RotateTransform/>
        </Ellipse.RenderTransform>
      </Ellipse>
    </Grid>
  </Viewbox>
</UserControl>
